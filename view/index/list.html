{extend name="layout/base" /} {block
name="title"}{$pageTitle|default='å…¨éƒ¨å•†å“'} - ç”µå­äº§å“ä¸æ‘©æ‰˜è½¦å•†åŸ{/block}
{block name="content"}
<div class="container">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb p-3 neomorphic-card mb-4">
      <li class="breadcrumb-item">
        <a href="/" class="text-decoration-none">é¦–é¡µ</a>
      </li>
      <li class="breadcrumb-item active gradient-text" aria-current="page">
        {$pageTitle|default='å…¨éƒ¨å•†å“'}
      </li>
    </ol>
  </nav>

  <div class="row">
    <!-- å·¦ä¾§ç­›é€‰æ  -->
    <div class="col-md-3">
      <div class="neomorphic-card gradient-border mb-4">
        <div class="card-header p-3">
          <h5 class="mb-0 gradient-heading">å•†å“ç­›é€‰</h5>
          <div class="header-line"></div>
        </div>
        <div class="card-body p-4">
          <form action="/products" method="get" id="filter-form">
            <!-- åˆ†ç±»ç­›é€‰ -->
            <div class="mb-4">
              <label class="form-label fw-bold mb-3">å•†å“åˆ†ç±»</label>
              <div class="filter-list">
                <a
                  href="/products"
                  class="filter-item {$categoryId == 0 ? 'active' : ''}"
                >
                  å…¨éƒ¨åˆ†ç±»
                </a>
                {foreach $categories as $cate}
                <a
                  href="/products?category_id={$cate.id}"
                  class="filter-item {$categoryId == $cate.id ? 'active' : ''}"
                >
                  {$cate.name}
                </a>
                {/foreach}
              </div>
            </div>

            <!-- ä»·æ ¼åŒºé—´ç­›é€‰ -->
            <div class="mb-4">
              <label class="form-label fw-bold mb-3">ä»·æ ¼åŒºé—´</label>
              <div class="price-range mb-3">
                <input
                  type="number"
                  class="form-control mb-2"
                  name="price_min"
                  value="{$priceMin}"
                  placeholder="æœ€ä½ä»·"
                />
                <input
                  type="number"
                  class="form-control"
                  name="price_max"
                  value="{$priceMax}"
                  placeholder="æœ€é«˜ä»·"
                />
              </div>
              <button
                type="button"
                class="neomorphic-btn btn-sm w-100"
                id="price-filter"
              >
                åº”ç”¨ä»·æ ¼ç­›é€‰
              </button>
            </div>

            <!-- å…³é”®è¯æœç´¢ -->
            <div class="mb-3">
              <label class="form-label fw-bold mb-3">å…³é”®è¯æœç´¢</label>
              <div class="search-group">
                <input
                  type="text"
                  class="form-control mb-2"
                  name="keyword"
                  value="{$keyword}"
                  placeholder="è¾“å…¥å…³é”®è¯"
                />
                <button class="neomorphic-btn btn-sm w-100" type="submit">
                  æœç´¢
                </button>
              </div>
            </div>

            <!-- éšè—å­—æ®µï¼Œç”¨äºä¿æŒæ’åºå’Œåˆ†é¡µ -->
            <input type="hidden" name="sort" value="{$sort}" />
            <input type="hidden" name="page_size" value="{$pageSize}" />
            {if $categoryId > 0}
            <input type="hidden" name="category_id" value="{$categoryId}" />
            {/if}
          </form>
        </div>
      </div>
    </div>

    <!-- å³ä¾§å•†å“åˆ—è¡¨ -->
    <div class="col-md-9">
      <!-- æ’åºå’Œæ˜¾ç¤ºé€‰é¡¹ -->
      <div class="neomorphic-card p-3 mb-4">
        <div
          class="d-flex flex-wrap justify-content-between align-items-center"
        >
          <div class="sort-group mb-2 mb-sm-0">
            <a
              href="/products?sort=default{$categoryId ? '&category_id='.$categoryId : ''}{$priceMin ? '&price_min='.$priceMin : ''}{$priceMax ? '&price_max='.$priceMax : ''}{$keyword ? '&keyword='.$keyword : ''}{$pageSize ? '&page_size='.$pageSize : ''}"
              class="sort-btn {$sort == 'default' ? 'active' : ''}"
              >é»˜è®¤æ’åº</a
            >
            <a
              href="/products?sort=price-asc{$categoryId ? '&category_id='.$categoryId : ''}{$priceMin ? '&price_min='.$priceMin : ''}{$priceMax ? '&price_max='.$priceMax : ''}{$keyword ? '&keyword='.$keyword : ''}{$pageSize ? '&page_size='.$pageSize : ''}"
              class="sort-btn {$sort == 'price-asc' ? 'active' : ''}"
              >ä»·æ ¼ä»ä½åˆ°é«˜</a
            >
            <a
              href="/products?sort=price-desc{$categoryId ? '&category_id='.$categoryId : ''}{$priceMin ? '&price_min='.$priceMin : ''}{$priceMax ? '&price_max='.$priceMax : ''}{$keyword ? '&keyword='.$keyword : ''}{$pageSize ? '&page_size='.$pageSize : ''}"
              class="sort-btn {$sort == 'price-desc' ? 'active' : ''}"
              >ä»·æ ¼ä»é«˜åˆ°ä½</a
            >
            <a
              href="/products?sort=sales-desc{$categoryId ? '&category_id='.$categoryId : ''}{$priceMin ? '&price_min='.$priceMin : ''}{$priceMax ? '&price_max='.$priceMax : ''}{$keyword ? '&keyword='.$keyword : ''}{$pageSize ? '&page_size='.$pageSize : ''}"
              class="sort-btn {$sort == 'sales-desc' ? 'active' : ''}"
              >é”€é‡ä¼˜å…ˆ</a
            >
          </div>
          <div class="page-size-dropdown">
            <div class="dropdown">
              <button
                class="neomorphic-btn btn-sm dropdown-toggle"
                type="button"
                id="pageSize"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                æ¯é¡µ {$pageSize} æ¡
              </button>
              <ul
                class="dropdown-menu dropdown-menu-end"
                aria-labelledby="pageSize"
              >
                <li>
                  <a
                    class="dropdown-item"
                    href="/products?page_size=12{$categoryId ? '&category_id='.$categoryId : ''}{$priceMin ? '&price_min='.$priceMin : ''}{$priceMax ? '&price_max='.$priceMax : ''}{$keyword ? '&keyword='.$keyword : ''}{$sort ? '&sort='.$sort : ''}"
                    >æ¯é¡µ 12 æ¡</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="/products?page_size=24{$categoryId ? '&category_id='.$categoryId : ''}{$priceMin ? '&price_min='.$priceMin : ''}{$priceMax ? '&price_max='.$priceMax : ''}{$keyword ? '&keyword='.$keyword : ''}{$sort ? '&sort='.$sort : ''}"
                    >æ¯é¡µ 24 æ¡</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="/products?page_size=36{$categoryId ? '&category_id='.$categoryId : ''}{$priceMin ? '&price_min='.$priceMin : ''}{$priceMax ? '&price_max='.$priceMax : ''}{$keyword ? '&keyword='.$keyword : ''}{$sort ? '&sort='.$sort : ''}"
                    >æ¯é¡µ 36 æ¡</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- å•†å“åˆ—è¡¨ -->
      {if $products->isEmpty()}
      <div class="neomorphic-card p-4 text-center">
        <div class="empty-state">
          <i class="empty-icon">ğŸ”</i>
          <h4 class="mt-3 mb-3 gradient-heading">æš‚æ— å•†å“</h4>
          <p class="text-muted">æŠ±æ­‰ï¼Œæ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å•†å“</p>
          <a href="/products" class="neomorphic-btn mt-3">æŸ¥çœ‹å…¨éƒ¨å•†å“</a>
        </div>
      </div>
      {else}
      <div class="row">
        {foreach $products as $product}
        <div class="col-sm-6 col-lg-4 mb-4">
          <div
            class="product-item h-100 position-relative gradient-border"
            data-category="{$product.category_id < 7 ? 'electronics' : 'motorcycle'}"
          >
            <!-- å•†å“æ ‡ç­¾ -->
            {if $product.is_recommend}
            <span class="product-badge badge bg-danger">æ¨è</span>
            {elseif $product.sales > 10}
            <span class="product-badge badge bg-warning text-dark">çƒ­é”€</span>
            {elseif $product.id > (max($products->column('id')) - 5)}
            <span class="product-badge badge bg-success">æ–°å“</span>
            {/if}

            <div class="product-img-container">
              <img
                src="{$product.image}"
                class="product-img"
                alt="{$product.name}"
              />
            </div>
            <div class="product-info p-3">
              <h5 class="product-title">{$product.name}</h5>
              <div
                class="d-flex justify-content-between align-items-center mb-3"
              >
                <span class="price">ï¿¥{$product.price}</span>
                <span class="sales-count">é”€é‡: {$product.sales}</span>
              </div>
              <div class="text-center mt-3">
                <a href="/product/{$product.id}" class="neomorphic-btn"
                  >æŸ¥çœ‹è¯¦æƒ…</a
                >
              </div>
            </div>
          </div>
        </div>
        {/foreach}
      </div>

      <!-- åˆ†é¡µ -->
      <div class="mt-4 d-flex justify-content-center">{$products|raw}</div>
      {/if}
    </div>
  </div>
</div>

{/block} {block name="css"}
<style>
  /* æ¸å˜æ–‡å­— */
  .gradient-text {
    font-weight: 600;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* é¦–é¡µé¢åŒ…å±‘ */
  .breadcrumb {
    border-radius: 15px;
    padding: 15px;
  }

  .breadcrumb-item a {
    color: var(--text-secondary);
    transition: all 0.3s ease;
  }

  .breadcrumb-item a:hover {
    color: #6e8efb;
    text-decoration: none;
  }

  /* é¦–é¡µå¡ç‰‡å¤´éƒ¨çº¿æ¡ */
  .header-line {
    height: 3px;
    background: var(--accent-gradient);
    margin-top: 10px;
    border-radius: 3px;
  }

  /* ç­›é€‰é¡¹æ ·å¼ */
  .filter-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .filter-item {
    display: block;
    padding: 12px 15px;
    border-radius: 10px;
    text-decoration: none;
    color: var(--text-primary);
    background: var(--card-bg);
    transition: all 0.3s ease;
    box-shadow: 3px 3px 6px var(--shadow-color-dark),
      -3px -3px 6px var(--shadow-color-light);
    position: relative;
    z-index: 5;
  }

  .filter-item:hover {
    transform: translateX(5px);
    color: #6e8efb;
  }

  .filter-item.active {
    background: var(--primary-gradient);
    color: white;
    box-shadow: inset 3px 3px 5px rgba(0, 0, 0, 0.1),
      inset -3px -3px 5px rgba(255, 255, 255, 0.05);
  }

  /* ä»·æ ¼ç­›é€‰ */
  .price-range {
    display: flex;
    flex-direction: column;
  }

  /* ä¿®æ”¹ä»·æ ¼åŒºé—´å’Œæœç´¢æ¡†çš„è¾“å…¥æ–‡å­—é¢œè‰² */
  .price-range .form-control,
  .search-group .form-control {
    background-color: var(--card-bg) !important;
    color: var(--text-primary) !important; /* ä½¿ç”¨é»‘è‰²æ–‡å­— */
    box-shadow: inset 3px 3px 5px var(--shadow-color-dark),
      inset -3px -3px 5px var(--shadow-color-light) !important;
  }

  .price-range .form-control::placeholder,
  .search-group .form-control::placeholder {
    color: var(--text-muted) !important; /* å ä½ç¬¦ä½¿ç”¨ç°è‰² */
    opacity: 0.7;
  }

  .price-range .form-control:focus,
  .search-group .form-control:focus {
    background-color: var(--card-bg) !important;
    box-shadow: inset 4px 4px 8px var(--shadow-color-dark),
      inset -4px -4px 8px var(--shadow-color-light) !important;
  }

  /* æ’åºæŒ‰é’® */
  .sort-group {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .sort-btn {
    padding: 8px 15px;
    border-radius: 10px;
    text-decoration: none;
    color: var(--text-primary);
    background: var(--card-bg);
    transition: all 0.3s ease;
    box-shadow: 3px 3px 6px var(--shadow-color-dark),
      -3px -3px 6px var(--shadow-color-light);
    font-size: 0.9rem;
    position: relative;
    z-index: 5;
  }

  .sort-btn:hover {
    color: #6e8efb;
    transform: translateY(-2px);
  }

  .sort-btn.active {
    background: var(--primary-gradient);
    color: white;
    box-shadow: inset 3px 3px 5px rgba(0, 0, 0, 0.1),
      inset -3px -3px 5px rgba(255, 255, 255, 0.05);
  }

  /* é”€é‡æ ‡ç­¾ */
  .sales-count {
    font-size: 0.85rem;
    color: var(--text-muted);
    background-color: rgba(0, 0, 0, 0.05);
    padding: 3px 8px;
    border-radius: 50px;
  }

  /* ç©ºçŠ¶æ€ */
  .empty-state {
    padding: 30px 0;
  }

  .empty-icon {
    font-size: 3rem;
    display: block;
    margin-bottom: 15px;
  }

  /* ç¡®ä¿è¡¨å•æ§ä»¶å’ŒæŒ‰é’®å¯ç‚¹å‡» */
  .form-control,
  .neomorphic-btn,
  .dropdown-toggle,
  button {
    position: relative;
    z-index: 10;
  }

  /* ä¿®å¤ä»·æ ¼ç­›é€‰æŒ‰é’® */
  #price-filter {
    position: relative;
    z-index: 10;
  }
</style>
{/block} {block name="js"}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // ä»·æ ¼ç­›é€‰æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    document
      .getElementById("price-filter")
      .addEventListener("click", function () {
        document.getElementById("filter-form").submit();
      });
  });
</script>
{/block}
