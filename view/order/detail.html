{extend name="layout/base" /} {block name="title"}è®¢å•è¯¦æƒ… -
åœ¨çº¿è´­ç‰©ç³»ç»Ÿ{/block} {block name="content"}

<div class="container">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb p-3 neomorphic-card mb-4">
      <li class="breadcrumb-item">
        <a href="/" class="text-decoration-none">é¦–é¡µ</a>
      </li>
      <li class="breadcrumb-item">
        <a href="/order" class="text-decoration-none">æˆ‘çš„è®¢å•</a>
      </li>
      <li class="breadcrumb-item active gradient-text" aria-current="page">
        è®¢å•è¯¦æƒ…
      </li>
    </ol>
  </nav>

  <h2 class="mb-4 gradient-heading">è®¢å•è¯¦æƒ…</h2>

  <div class="neomorphic-card mb-4">
    <div class="card-header p-3">
      <h4 class="mb-0 gradient-heading">è®¢å•ä¿¡æ¯</h4>
      <div class="header-line"></div>
    </div>
    <div class="card-body p-4">
      <div class="row">
        <div class="col-md-6">
          <div class="info-item">
            <span class="info-label">è®¢å•å·ï¼š</span>
            <span class="info-value">{$order.order_no}</span>
          </div>
          <div class="info-item">
            <span class="info-label">è®¢å•çŠ¶æ€ï¼š</span>
            <span class="info-value">
              {switch name="order.status"} {case value="0"}<span
                class="status-badge status-waiting"
                >å¾…ä»˜æ¬¾</span
              >{/case} {case value="1"}<span class="status-badge status-paid"
                >å·²ä»˜æ¬¾</span
              >{/case} {case value="2"}<span class="status-badge status-shipped"
                >å·²å‘è´§</span
              >{/case} {case value="3"}<span
                class="status-badge status-completed"
                >å·²å®Œæˆ</span
              >{/case} {case value="4"}<span
                class="status-badge status-cancelled"
                >å·²å–æ¶ˆ</span
              >{/case} {/switch}
            </span>
          </div>
          <div class="info-item">
            <span class="info-label">åˆ›å»ºæ—¶é—´ï¼š</span>
            <span class="info-value">{$order.create_time}</span>
          </div>
          {if $order.pay_time}
          <div class="info-item">
            <span class="info-label">æ”¯ä»˜æ—¶é—´ï¼š</span>
            <span class="info-value">{$order.pay_time}</span>
          </div>
          {/if} {if $order.delivery_time}
          <div class="info-item">
            <span class="info-label">å‘è´§æ—¶é—´ï¼š</span>
            <span class="info-value">{$order.delivery_time}</span>
          </div>
          {/if} {if $order.complete_time}
          <div class="info-item">
            <span class="info-label">å®Œæˆæ—¶é—´ï¼š</span>
            <span class="info-value">{$order.complete_time}</span>
          </div>
          {/if}
        </div>
        <div class="col-md-6">
          <div class="info-item">
            <span class="info-label">æ”¶è´§äººï¼š</span>
            <span class="info-value">{$order.consignee}</span>
          </div>
          <div class="info-item">
            <span class="info-label">è”ç³»ç”µè¯ï¼š</span>
            <span class="info-value">{$order.mobile}</span>
          </div>
          <div class="info-item">
            <span class="info-label">æ”¶è´§åœ°å€ï¼š</span>
            <span class="info-value">{$order.address}</span>
          </div>
          <div class="info-item">
            <span class="info-label">è®¢å•é‡‘é¢ï¼š</span>
            <span class="info-value gradient-price"
              >ï¿¥{$order.total_amount}</span
            >
          </div>
        </div>
      </div>

      {if $order.status == 0}
      <div class="mt-4 action-buttons">
        <button
          class="neomorphic-btn btn-success pay-order"
          data-id="{$order.id}"
        >
          <i class="pay-icon">ğŸ’³</i> ç«‹å³ä»˜æ¬¾
        </button>
        <button
          class="neomorphic-btn btn-danger cancel-order"
          data-id="{$order.id}"
        >
          <i class="cancel-icon">âŒ</i> å–æ¶ˆè®¢å•
        </button>
      </div>
      {elseif $order.status == 2}
      <div class="mt-4 action-buttons">
        <button
          class="neomorphic-btn btn-success confirm-order"
          data-id="{$order.id}"
        >
          <i class="confirm-icon">âœ…</i> ç¡®è®¤æ”¶è´§
        </button>
      </div>
      {/if}
    </div>
  </div>

  <div class="neomorphic-card">
    <div class="card-header p-3">
      <h4 class="mb-0 gradient-heading">å•†å“ä¿¡æ¯</h4>
      <div class="header-line"></div>
    </div>
    <div class="card-body p-4">
      <div class="table-responsive">
        <table class="table order-products-table">
          <thead>
            <tr
              class="table-header"
              style="background-color: rgb(230, 233, 240) !important"
            >
              <th
                class="header-cell"
                style="background-color: rgb(230, 233, 240) !important"
              >
                å•†å“
              </th>
              <th
                class="header-cell"
                style="background-color: rgb(230, 233, 240) !important"
              >
                å•ä»·
              </th>
              <th
                class="header-cell"
                style="background-color: rgb(230, 233, 240) !important"
              >
                æ•°é‡
              </th>
              <th
                class="header-cell"
                style="background-color: rgb(230, 233, 240) !important"
              >
                å°è®¡
              </th>
            </tr>
          </thead>

          <tbody>
            {volist name="order.order_details" id="detail"}
            <tr class="product-item">
              <td>
                <div class="d-flex align-items-center">
                  <div class="product-img-container">
                    <img
                      src="{$detail.product_image}"
                      alt="{$detail.product_name}"
                      class="product-img"
                    />
                  </div>
                  <div class="ms-3">
                    <h5 class="product-name">{$detail.product_name}</h5>
                  </div>
                </div>
              </td>
              <td class="product-price">ï¿¥{$detail.product_price}</td>
              <td class="product-quantity">{$detail.quantity}</td>
              <td class="product-total">
                <span class="gradient-price">ï¿¥{$detail.total_price}</span>
              </td>
            </tr>
            {/volist}
          </tbody>
          <tfoot>
            <tr class="total-row">
              <td colspan="3" class="text-end"><strong>æ€»è®¡ï¼š</strong></td>
              <td class="order-total gradient-total-price">
                ï¿¥{$order.total_amount}
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
</div>
{/block} {block name="css"}
<style>
  /* æ¸å˜æ ‡é¢˜ */
  .gradient-heading {
    font-weight: 700;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: #6e8efb;
  }

  /* æ¸å˜æ–‡å­— */
  .gradient-text {
    font-weight: 600;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: #6e8efb;
  }

  /* é¢åŒ…å±‘ */
  .breadcrumb {
    border-radius: 15px;
    padding: 15px;
  }

  .breadcrumb-item a {
    color: var(--text-secondary);
    transition: all 0.3s ease;
    position: relative;
    z-index: 5;
  }

  .breadcrumb-item a:hover {
    color: #6e8efb;
    text-decoration: none;
  }

  /* å¡ç‰‡å¤´éƒ¨çº¿æ¡ */
  .header-line {
    height: 3px;
    background: var(--accent-gradient);
    margin-top: 10px;
    border-radius: 3px;
  }

  /* è®¢å•ä¿¡æ¯é¡¹ */
  .info-item {
    margin-bottom: 15px;
    display: flex;
    flex-wrap: wrap;
  }

  .info-label {
    font-weight: 600;
    color: var(--text-secondary);
    margin-right: 10px;
    min-width: 90px;
  }

  .info-value {
    color: var(--text-primary);
  }

  /* è®¢å•çŠ¶æ€æ ‡ç­¾ */
  .status-badge {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 50px;
    font-weight: 600;
    font-size: 0.9rem;
    color: white;
    background: var(--button-gradient);
    box-shadow: 5px 5px 10px var(--shadow-color-dark),
      -5px -5px 10px rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    position: relative;
    z-index: 50;
    letter-spacing: 0.5px;
    border: none;
  }

  .status-waiting {
    background: linear-gradient(135deg, #ff6b6b, #ff9a9e);
  }

  .status-paid {
    background: linear-gradient(135deg, #4facfe, #00f2fe);
  }

  .status-shipped {
    background: linear-gradient(135deg, #0061ff, #60efff);
  }

  .status-completed {
    background: linear-gradient(135deg, #0ba360, #3cba92);
  }

  .status-cancelled {
    background: linear-gradient(135deg, #ff4e50, #f9d423);
  }

  /* æ“ä½œæŒ‰é’® */
  .action-buttons {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
  }

  .btn-success {
    background: linear-gradient(135deg, #84fab0, #8fd3f4);
    color: #0e5924;
  }

  .btn-success:hover {
    background: linear-gradient(135deg, #8fd3f4, #84fab0);
  }

  .btn-danger {
    background: linear-gradient(135deg, #ff9a9e, #fad0c4);
    color: #9c1a1a;
  }

  .btn-danger:hover {
    background: linear-gradient(135deg, #fad0c4, #ff9a9e);
  }

  .pay-icon,
  .cancel-icon,
  .confirm-icon {
    margin-right: 8px;
  }

  /* å•†å“è¡¨æ ¼ */
  .order-products-table {
    border-collapse: separate;
    border-spacing: 0 15px;
    margin-bottom: 0;
    width: 100%;
    margin-top: -10px; /* å‡å°‘è¡¨å¤´å’Œå†…å®¹ä¹‹é—´çš„é—´è· */
  }

  .table-header {
    background: rgb(230, 233, 240) !important;
    border-radius: 15px;
    box-shadow: 3px 3px 6px var(--shadow-color-dark),
      -3px -3px 6px var(--shadow-color-light);
    margin-bottom: 5px;
  }

  .table-header th {
    color: var(--text-primary);
    font-weight: 700;
    padding: 15px;
    border: none;
    letter-spacing: 0.5px;
  }

  .table-header th:first-child {
    border-top-left-radius: 15px;
    border-bottom-left-radius: 15px;
  }

  .table-header th:last-child {
    border-top-right-radius: 15px;
    border-bottom-right-radius: 15px;
  }

  /* æ·»åŠ è¡¨å¤´æ ·å¼ */
  .order-products-table thead th {
    background: rgb(230, 233, 240);
    position: relative;
    z-index: 5;
  }

  /* è¡¨å¤´å•å…ƒæ ¼æ ·å¼ */
  .header-cell {
    background: rgb(230, 233, 240) !important;
    color: var(--text-primary);
    font-weight: 700;
    text-align: center;
    position: relative;
  }

  .header-cell::after {
    content: "";
    position: absolute;
    bottom: 5px;
    left: 15%;
    width: 70%;
    height: 2px;
    background: var(--primary-gradient);
    border-radius: 2px;
    transition: all 0.3s ease;
  }

  .product-item {
    background: rgb(230, 233, 240);
    border-radius: 15px;
    box-shadow: 5px 5px 10px var(--shadow-color-dark),
      -5px -5px 10px var(--shadow-color-light);
    transition: all 0.3s ease;
    position: relative;
    z-index: 10;
  }

  .product-item:hover {
    transform: translateY(-3px);
    box-shadow: 8px 8px 15px var(--shadow-color-dark),
      -8px -8px 15px var(--shadow-color-light);
    background: rgb(220, 225, 235);
  }

  .product-item td {
    padding: 15px;
    border: none;
    vertical-align: middle;
    background: rgb(230, 233, 240);
  }

  .product-item td:first-child {
    border-top-left-radius: 15px;
    border-bottom-left-radius: 15px;
  }

  .product-item td:last-child {
    border-top-right-radius: 15px;
    border-bottom-right-radius: 15px;
  }

  /* å•†å“å›¾ç‰‡ */
  .product-img-container {
    width: 80px;
    height: 80px;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 3px 3px 6px var(--shadow-color-dark),
      -3px -3px 6px var(--shadow-color-light);
  }

  .product-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* å•†å“åç§° */
  .product-name {
    font-weight: 700;
    font-size: 1rem;
    margin-bottom: 0;
    transition: all 0.3s ease;
    color: #6e8efb;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    background-clip: text;
  }

  /* ä»·æ ¼æ ·å¼ */
  .product-price,
  .product-quantity {
    font-weight: 700;
    font-size: 1rem;
    color: var(--text-primary);
  }

  .product-quantity {
    background: #f0f2f5;
    padding: 5px 10px;
    border-radius: 50px;
    display: inline-block;
    box-shadow: inset 2px 2px 5px var(--shadow-color-dark),
      inset -2px -2px 5px var(--shadow-color-light);
  }

  .gradient-price {
    font-weight: 700;
    font-size: 1.1rem;
    background: var(--secondary-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: #966edc;
  }

  .gradient-total-price {
    font-weight: 700;
    font-size: 1.3rem;
    color: #966edc;
  }

  /* æ€»è®¡è¡Œ */
  .total-row {
    background: transparent;
    font-size: 1.1rem;
  }

  .total-row td {
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    padding-top: 20px;
    color: var(--text-primary);
    background: transparent !important;
  }

  .order-total {
    font-weight: 800;
    font-size: 1.4rem;
  }

  /* ä¿®å¤å°è®¡åˆ—æ ·å¼ */
  .product-total {
    background: rgb(230, 233, 240) !important; /* å¼ºåˆ¶ä½¿ç”¨ä¸è¡Œç›¸åŒçš„èƒŒæ™¯è‰² */
  }

  /* ç¡®ä¿è¡¨æ ¼å†…æ‰€æœ‰å•å…ƒæ ¼èƒŒæ™¯ä¸€è‡´ */
  .order-products-table tbody td {
    background: rgb(230, 233, 240);
  }

  /* ç¡®ä¿è¡¨æ ¼è¡Œæ‚¬åœæ—¶æ‰€æœ‰å•å…ƒæ ¼èƒŒæ™¯ä¸€è‡´ */
  .product-item:hover td {
    background: rgb(220, 225, 235);
  }

  /* ç¡®ä¿æ€»è®¡è¡Œä¸å—è¡¨æ ¼è¡Œæ ·å¼å½±å“ */
  .order-products-table tfoot td {
    background: transparent !important;
  }

  /* å¼ºåˆ¶åº”ç”¨è¡¨å¤´èƒŒæ™¯è‰² */
  .table-header,
  .table-header th,
  .order-products-table thead,
  .order-products-table thead tr,
  .order-products-table thead th {
    background-color: rgb(230, 233, 240) !important;
  }
</style>
{/block} {block name="js"}
<script>
  $(function () {
    // æ”¯ä»˜è®¢å•
    $(".pay-order").click(function () {
      var orderId = $(this).data("id");

      if (confirm("ç¡®å®šè¦æ”¯ä»˜è¿™ä¸ªè®¢å•å—ï¼Ÿ")) {
        $.ajax({
          url: "/order/pay",
          type: "POST",
          data: { order_id: orderId },
          dataType: "json",
          success: function (res) {
            if (res.code === 1) {
              alert(res.msg);
              location.reload();
            } else {
              alert(res.msg);
            }
          },
          error: function () {
            alert("æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åå†è¯•");
          },
        });
      }
    });

    // å–æ¶ˆè®¢å•
    $(".cancel-order").click(function () {
      var orderId = $(this).data("id");

      if (confirm("ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªè®¢å•å—ï¼Ÿ")) {
        $.ajax({
          url: "/order/cancel",
          type: "POST",
          data: { order_id: orderId },
          dataType: "json",
          success: function (res) {
            if (res.code === 1) {
              alert(res.msg);
              location.reload();
            } else {
              alert(res.msg);
            }
          },
          error: function () {
            alert("æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åå†è¯•");
          },
        });
      }
    });

    // ç¡®è®¤æ”¶è´§
    $(".confirm-order").click(function () {
      var orderId = $(this).data("id");

      if (confirm("ç¡®è®¤å·²æ”¶åˆ°å•†å“å—ï¼Ÿ")) {
        $.ajax({
          url: "/order/complete",
          type: "POST",
          data: { order_id: orderId },
          dataType: "json",
          success: function (res) {
            if (res.code === 1) {
              alert(res.msg);
              location.reload();
            } else {
              alert(res.msg);
            }
          },
          error: function () {
            alert("æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åå†è¯•");
          },
        });
      }
    });
  });
</script>
{/block}
