{extend name="layout/base" /} {block name="title"}æˆ‘çš„è®¢å• -
åœ¨çº¿è´­ç‰©ç³»ç»Ÿ{/block} {block name="content"}
<div class="container">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb p-3 neomorphic-card mb-4">
      <li class="breadcrumb-item">
        <a href="/" class="text-decoration-none">é¦–é¡µ</a>
      </li>
      <li class="breadcrumb-item active gradient-text" aria-current="page">
        æˆ‘çš„è®¢å•
      </li>
    </ol>
  </nav>

  <h2 class="mb-4 gradient-heading">æˆ‘çš„è®¢å•</h2>

  <div class="neomorphic-card">
    <div class="card-header p-3">
      <div class="order-tabs">
        <a class="order-tab {if $status === null}active{/if}" href="/order"
          >å…¨éƒ¨è®¢å•</a
        >
        <a
          class="order-tab {if $status === 0}active{/if}"
          href="/order?status=0"
          >å¾…ä»˜æ¬¾</a
        >
        <a
          class="order-tab {if $status === 1}active{/if}"
          href="/order?status=1"
          >å·²ä»˜æ¬¾</a
        >
        <a
          class="order-tab {if $status === 2}active{/if}"
          href="/order?status=2"
          >å·²å‘è´§</a
        >
        <a
          class="order-tab {if $status === 3}active{/if}"
          href="/order?status=3"
          >å·²å®Œæˆ</a
        >
        <a
          class="order-tab {if $status === 4}active{/if}"
          href="/order?status=4"
          >å·²å–æ¶ˆ</a
        >
      </div>
    </div>
    <div class="card-body p-4">
      {if $orders->isEmpty()}
      <div class="empty-state text-center">
        <i class="empty-icon">ğŸ“‹</i>
        <h4 class="mt-3 mb-3 gradient-heading">æš‚æ— è®¢å•</h4>
        <p class="text-muted">æ‚¨è¿˜æ²¡æœ‰ç›¸å…³è®¢å•ï¼Œå¿«å»é€‰è´­å•†å“å§ï¼</p>
        <a href="/products" class="neomorphic-btn mt-3">å»è´­ç‰©</a>
      </div>
      {else}
      <div class="order-list">
        {volist name="orders" id="order"}
        <div class="order-item">
          <div class="order-header">
            <div class="order-no">
              è®¢å•å·: <span class="fw-bold">{$order.order_no}</span>
            </div>
            <div class="order-date">{$order.create_time}</div>
          </div>
          <div class="order-body">
            <div class="order-products">
              {volist name="order.order_details" id="detail" length="1"}
              <div class="d-flex align-items-center">
                <div class="order-img-container">
                  <img
                    src="{$detail.product_image}"
                    alt="{$detail.product_name}"
                    class="order-product-img"
                  />
                </div>
                <div class="ms-3">
                  <div class="product-name">{$detail.product_name}</div>
                  {if count($order['order_details']) > 1}
                  <div class="product-count">
                    ç­‰{:count($order['order_details'])}ä»¶å•†å“
                  </div>
                  {/if}
                </div>
              </div>
              {/volist}
            </div>
            <div class="order-price gradient-price">
              ï¿¥{$order.total_amount}
            </div>
            <div class="order-status">
              {switch name="order.status"} {case value="0"}<span
                class="status-badge status-waiting"
                >å¾…ä»˜æ¬¾</span
              >{/case} {case value="1"}<span class="status-badge status-paid"
                >å·²ä»˜æ¬¾</span
              >{/case} {case value="2"}<span class="status-badge status-shipped"
                >å·²å‘è´§</span
              >{/case} {case value="3"}<span
                class="status-badge status-completed"
                >å·²å®Œæˆ</span
              >{/case} {case value="4"}<span
                class="status-badge status-cancelled"
                >å·²å–æ¶ˆ</span
              >{/case} {/switch}
            </div>
            <div class="order-actions">
              <a href="/order/detail/{$order.id}" class="neomorphic-btn btn-sm"
                >æŸ¥çœ‹è¯¦æƒ…</a
              >
              {if $order.status == 0}
              <button
                class="neomorphic-btn btn-sm btn-success pay-order"
                data-id="{$order.id}"
              >
                ç«‹å³ä»˜æ¬¾
              </button>
              <button
                class="neomorphic-btn btn-sm btn-danger cancel-order"
                data-id="{$order.id}"
              >
                å–æ¶ˆè®¢å•
              </button>
              {/if}
            </div>
          </div>
        </div>
        {/volist}
      </div>
      <div class="mt-4 d-flex justify-content-center">{$orders|raw}</div>
      {/if}
    </div>
  </div>
</div>
{/block} {block name="css"}
<style>
  /* æ¸å˜æ ‡é¢˜ */
  .gradient-heading {
    font-weight: 700;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: #6e8efb;
  }

  /* æ¸å˜æ–‡å­— */
  .gradient-text {
    font-weight: 600;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: #6e8efb;
  }

  /* é¢åŒ…å±‘ */
  .breadcrumb {
    border-radius: 15px;
    padding: 15px;
  }

  .breadcrumb-item a {
    color: var(--text-secondary);
    transition: all 0.3s ease;
    position: relative;
    z-index: 5;
  }

  .breadcrumb-item a:hover {
    color: #6e8efb;
    text-decoration: none;
  }

  /* è®¢å•æ ‡ç­¾é¡µ */
  .order-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 10px;
  }

  .order-tab {
    padding: 10px 15px;
    border-radius: 10px;
    text-decoration: none;
    color: var(--text-primary);
    background: var(--card-bg);
    transition: all 0.3s ease;
    box-shadow: 3px 3px 6px var(--shadow-color-dark),
      -3px -3px 6px var(--shadow-color-light);
    font-size: 0.95rem;
    position: relative;
    z-index: 5;
  }

  .order-tab:hover {
    transform: translateY(-3px);
    color: #6e8efb;
    text-decoration: none;
  }

  .order-tab.active {
    background: var(--primary-gradient);
    color: white;
    box-shadow: inset 3px 3px 5px rgba(0, 0, 0, 0.1),
      inset -3px -3px 5px rgba(255, 255, 255, 0.05);
  }

  /* è®¢å•åˆ—è¡¨ */
  .order-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .order-item {
    background: var(--card-bg);
    border-radius: 15px;
    box-shadow: 5px 5px 10px var(--shadow-color-dark),
      -5px -5px 10px var(--shadow-color-light);
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .order-item:hover {
    transform: translateY(-3px);
    box-shadow: 7px 7px 15px var(--shadow-color-dark),
      -7px -7px 15px var(--shadow-color-light);
  }

  /* è®¢å•å¤´éƒ¨ */
  .order-header {
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.02);
    display: flex;
    justify-content: space-between;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  }

  .order-no {
    color: var(--text-secondary);
    font-size: 0.9rem;
  }

  .order-date {
    color: var(--text-muted);
    font-size: 0.85rem;
  }

  /* è®¢å•å†…å®¹ */
  .order-body {
    padding: 20px;
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    align-items: center;
    gap: 15px;
  }

  @media (max-width: 768px) {
    .order-body {
      grid-template-columns: 1fr;
      gap: 20px;
    }
  }

  /* è®¢å•å•†å“ */
  .order-img-container {
    width: 60px;
    height: 60px;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 2px 2px 5px var(--shadow-color-dark),
      -2px -2px 5px var(--shadow-color-light);
  }

  .order-product-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .product-name {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 5px;
  }

  .product-count {
    font-size: 0.85rem;
    color: var(--text-muted);
  }

  /* è®¢å•ä»·æ ¼ */
  .gradient-price {
    font-weight: 700;
    font-size: 1.2rem;
    background: var(--secondary-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: #966edc;
  }

  /* è®¢å•çŠ¶æ€æ ‡ç­¾ */
  .status-badge {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 50px;
    font-weight: 600;
    font-size: 0.9rem;
    color: white;
    background: var(--button-gradient);
    box-shadow: 5px 5px 10px var(--shadow-color-dark),
      -5px -5px 10px rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    position: relative;
    z-index: 50;
    letter-spacing: 0.5px;
    border: none;
  }

  .status-waiting {
    background: linear-gradient(135deg, #ff6b6b, #ff9a9e);
  }

  .status-paid {
    background: linear-gradient(135deg, #4facfe, #00f2fe);
  }

  .status-shipped {
    background: linear-gradient(135deg, #0061ff, #60efff);
  }

  .status-completed {
    background: linear-gradient(135deg, #0ba360, #3cba92);
  }

  .status-cancelled {
    background: linear-gradient(135deg, #ff4e50, #f9d423);
  }

  /* è®¢å•æ“ä½œæŒ‰é’® */
  .order-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }

  /* æŒ‰é’®æ ·å¼ */
  .btn-success {
    background: linear-gradient(135deg, #84fab0, #8fd3f4);
    color: #2b8a3e;
  }

  .btn-success:hover {
    background: linear-gradient(135deg, #8fd3f4, #84fab0);
  }

  .btn-danger {
    background: linear-gradient(135deg, #ff9a9e, #fad0c4);
    color: #c85450;
  }

  .btn-danger:hover {
    background: linear-gradient(135deg, #fad0c4, #ff9a9e);
  }

  .btn-sm {
    padding: 8px 15px;
    font-size: 0.85rem;
  }

  /* ç©ºè®¢å•çŠ¶æ€ */
  .empty-state {
    padding: 40px 0;
  }

  .empty-icon {
    font-size: 4rem;
    display: block;
    margin-bottom: 15px;
  }

  /* ç¡®ä¿æ‰€æœ‰æŒ‰é’®å¯ç‚¹å‡» */
  button,
  .neomorphic-btn,
  .order-tab {
    position: relative;
    z-index: 5;
  }
</style>
{/block} {block name="js"}
<script>
  $(function () {
    // æ”¯ä»˜è®¢å•
    $(".pay-order").click(function () {
      var orderId = $(this).data("id");

      if (confirm("ç¡®å®šè¦æ”¯ä»˜è¿™ä¸ªè®¢å•å—ï¼Ÿ")) {
        $.ajax({
          url: "/order/pay",
          type: "POST",
          data: { order_id: orderId },
          dataType: "json",
          success: function (res) {
            if (res.code === 1) {
              alert(res.msg);
              location.reload();
            } else {
              alert(res.msg);
            }
          },
          error: function () {
            alert("æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åå†è¯•");
          },
        });
      }
    });

    // å–æ¶ˆè®¢å•
    $(".cancel-order").click(function () {
      var orderId = $(this).data("id");

      if (confirm("ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªè®¢å•å—ï¼Ÿ")) {
        $.ajax({
          url: "/order/cancel",
          type: "POST",
          data: { order_id: orderId },
          dataType: "json",
          success: function (res) {
            if (res.code === 1) {
              alert(res.msg);
              location.reload();
            } else {
              alert(res.msg);
            }
          },
          error: function () {
            alert("æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åå†è¯•");
          },
        });
      }
    });
  });
</script>
{/block}
